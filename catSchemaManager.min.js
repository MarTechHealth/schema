import{Dom}from"https://lp-service-core.nyc3.digitaloceanspaces.com/lp-tools/tools-core/mod/dom.min.js";import{BdApi}from"https://lp-service-core.nyc3.digitaloceanspaces.com/lp-tools/tools-core/mod/bdApi.min.js";import{Form}from"https://lp-service-core.nyc3.digitaloceanspaces.com/lp-tools/tools-core/comp/form.min.js";import{DynamicTable}from"https://lp-service-core.nyc3.digitaloceanspaces.com/lp-tools/tools-core/comp/dynamicTable.min.js";import{Dialog}from"https://lp-service-core.nyc3.digitaloceanspaces.com/lp-tools/tools-core/comp/dialog.min.js";import{Toast}from"https://lp-service-core.nyc3.digitaloceanspaces.com/lp-tools/tools-core/comp/toast.min.js";import{LayoutElement}from"https://lp-service-core.nyc3.digitaloceanspaces.com/lp-tools/tools-core/comp/layoutElement.min.js";function CatSchemaManager(){const a=new Dom,b=new BdApi,c=new Form,d=new Dialog,f=new Toast,g=new LayoutElement;let h;const i={mainWidget:`lp-schema-manager-api`};let j;const k={container:`lp-cat-users-schema-tool-master-container`,table:{container:`lp-custmc-table-container`,dataTable:{filters:{filterButton:`lp-custmc-tc-tdc-fc-filter-button`,schemaFilter:{container:`lp-custmc-tc-tdc-fc-schema-filter-container`,input:`lp-custmc-tc-tdc-fc-sfc-input`,label:`lp-custmc-tc-tdc-fc-sfc-label`,iconCheck:`lp-custmc-tc-tdc-fc-sfc-icon`,iconUnCheck:`lp-custmc-tc-tdc-fc-sfc-icon-uncheck`,text:`lp-custmc-tc-tdc-fc-sfc-tet`},subscriptionSelect:`lp-custmc-tc-tdc-fc-subscription-select`}}},details:{container:`lp-custmc-details-container`,innerSlideContainer:`lp-custmc-dc-inner-slide-container`,title:`lp-custmc-dc-title`,memberPreview:{container:`lp-custmc-dc-member-preview-container`,thumbnail:`lp-custmc-dc-mpc-thumbnail`,name:`lp-custmc-dc-mpc-name`,closeButton:`lp-custmc-dc-mpc-close-button`},form:`lp-custmc-dc-form`,formElements:{textarea:`lp-custmc-dc-f-textarea`,editor:{options:{container:`lp-custmc-dc-f-editor-options-container`,fullScreenButton:`lp-custmc-dc-f-eoc-full-screen-button`,defaultSchemaButton:`lp-custmc-dc-f-eoc-default-schema-button`},element:`lp-custmc-dc-f-editor-element`},submitButton:`lp-custmc-dc-f-submit-button`}}},l={table:{row:{userInfo:{container:`lp-custmc-tc-user-info-container`,thumbnail:`lp-custmc-tc-uic-thumbnail`,name:`lp-custmc-tc-uic-name`},schema:{container:`lp-custmc-tc-schema-container`,icon:`lp-custmc-tc-sc-icon`,status:`lp-custmc-tc-sc-status`,createdAt:`lp-custmc-tc-sc-created-at`,updatedAt:`lp-custmc-tc-sc-updated-at`},actions:{container:`lp-custmc-tc-actions-container`,editButton:`lp-custmc-tc-ac-edit-button`}}}},m=(l={user_id:0})=>{const n=document.createDocumentFragment(),o=document.getElementById(k.details.innerSlideContainer),p=async a=>{a.preventDefault();const c={user_id:l.user_id,schema_content:h.getValue()},e=await b.adminApiPost(c,`save-schema`,i.mainWidget);1===e.info.save_status?(j.loadPage(),f.renderToast({icon:`fa fa-floppy-o`,title:`Success`,text:`Your new schema updates have been saved.`})):d.centerDialog({title:`Error`,text:`There has been an error trying to perform this action, please reload the page and try it again.`,showCancelButton:!1,confirmButtonText:`Ok`})};if(0===l.user_id)n.append(a.node(`div`,{id:k.details.memberPreview.container},void 0,[a.node(`span`,{id:k.details.memberPreview.thumbnail}),a.node(`span`,{id:k.details.memberPreview.name},void 0,[`Pick a member to update their schema data`])]));else{const b={attributes:{action:`#`,type:`post`,onsubmit:p,id:k.details.form}},d=[{attributes:{value:()=>{const b=a=>{if(``!==a){const b=JSON.parse(a.replace(`<script type="application/ld+json">`,``).replace(`</script>`,``)),c=JSON.stringify(b,null,4);return`<script type="application/ld+json">
${c} 
</script>`}return``},c=a.node(`div`,{id:k.details.formElements.editor.element}),d=document.createDocumentFragment(),e=()=>h.setValue(b(l.default_schema));return d.append(a.node(`div`,{id:k.details.formElements.editor.options.container},void 0,[a.node(`button`,{type:`button`,id:k.details.formElements.editor.options.defaultSchemaButton,onclick:e},void 0,[`Load Default Schema`]),a.node(`button`,{type:`button`,id:k.details.formElements.editor.options.fullScreenButton,title:`Full Screen Editor`,onclick:()=>c.requestFullscreen()},void 0,[a.node(`i`,{className:`fa fa-expand`})])]),c),h=ace.edit(c,{mode:`ace/mode/php`,selectionStyle:`text`}),h.setOption("wrap",!0),h.setTheme(`ace/theme/monokai`),l.schema_content&&h.setValue(b(l.schema_content)),d}},settings:{type:`customHtml`}},{attributes:{type:`submit`,value:a.node(`span`,void 0,void 0,[`Save Schema Structure`]),id:k.details.formElements.submitButton},settings:{type:`button`}}],e=g.renderUserThumbImage(l.user_info);e.id=k.details.memberPreview.thumbnail,n.append(a.node(`div`,{id:k.details.memberPreview.container},void 0,[e,a.node(`span`,{id:k.details.memberPreview.name},void 0,[l.user_info.full_name]),a.node(`button`,{id:k.details.memberPreview.closeButton,onclick:()=>m()},void 0,[a.node(`i`,{className:`fa fa-times`})])]),c.renderFormUi(b,d))}a.emptyNodeContents(o),o.append(n)},n=c=>{const d=document.createDocumentFragment(),e={sqlEngineApiAction:`schema-dynamic-table`,sqlEngingeApi:i.mainWidget,tableTitle:a.simpleNode(`h2`,void 0,void 0,[`User Schema`]),loadPageCallback:()=>{document.getElementById(k.details.formElements.editor.element)&&h.resize()},tableFiltersMap:[{attributes:{type:`text`,name:`keyword`,placeholder:`Keyword Search`},settings:{type:`singleInput`,display:`dynamicTableText`,label:``}},{attributes:{name:`subscription_id`,id:k.table.dataTable.filters.subscriptionSelect},options:async()=>{const a=await b.adminApiPost({},`get-site-subscriptions`,i.mainWidget);return[{label:`Pick a Subscription`,value:``},...a.info.subscriptions.map(a=>({label:a.subscription_name,value:a.subscription_id}))]},settings:{type:`selectDropdown`}},{attributes:{value:()=>{const b=document.createDocumentFragment();return b.append(a.node(`label`,{id:k.table.dataTable.filters.schemaFilter.container},void 0,[a.node(`input`,{type:`checkbox`,id:k.table.dataTable.filters.schemaFilter.input,name:`filter_schema`,value:`1`}),a.node(`div`,{id:k.table.dataTable.filters.schemaFilter.label},void 0,[a.node(`i`,{className:`fa fa-square-o`,id:k.table.dataTable.filters.schemaFilter.iconUnCheck}),a.node(`i`,{className:`fa fa-check-square-o`,id:k.table.dataTable.filters.schemaFilter.iconCheck}),a.node(`span`,{id:k.table.dataTable.filters.schemaFilter.text},void 0,[`Custom Schemas`])])])),b}},settings:{type:`customHtml`}},{attributes:{id:k.table.dataTable.filters.filterButton,value:a.node(`span`,void 0,void 0,[`Filter`])},settings:{type:`button`}}],tableMapping:[{label:`ID`,infoFormatting:a=>a.user_id,sort:`user-id`},{label:`User`,infoFormatting:b=>{const c=document.createDocumentFragment(),d=g.renderUserThumbImage(b.user_info);return a.nodeAddClass(d,l.table.row.userInfo.thumbnail),c.append(a.node(`div`,{className:l.table.row.userInfo.container},void 0,[d,a.node(`span`,{className:l.table.row.userInfo.name},void 0,[b.user_info.full_name])])),c},sort:`user-name`},{label:`Subscription`,infoFormatting:a=>a.subscription_name,sort:`susbcription-name`},{label:`Schema`,infoFormatting:b=>{const c=document.createDocumentFragment();return null==b.schema_content?c.append(a.node(`div`,{className:l.table.row.schema.container},void 0,[a.node(`div`,{className:l.table.row.schema.icon},{status:`default`},[a.node(`i`,{className:`fa fa-cubes`})]),a.node(`span`,{className:l.table.row.schema.status},void 0,[`DEFAULT SCHEMA `])])):c.append(a.node(`div`,{className:l.table.row.schema.container},void 0,[a.node(`div`,{className:l.table.row.schema.icon},{status:`custom`},[a.node(`i`,{className:`fa fa-pencil-square-o`})]),a.node(`span`,{className:l.table.row.schema.status},void 0,[`CUSTOM SCHEMA `]),a.node(`span`,{className:l.table.row.schema.createdAt},void 0,[`C: ${b.schema_created_at}`]),`0000-00-00 00:00:00`!==b.schema_updated_at&&``!==b.schema_updated_at?a.node(`span`,{className:l.table.row.schema.updatedAt},void 0,[`U: ${b.schema_updated_at}`]):``])),c}},{label:`Actions`,infoFormatting:b=>a.node(`div`,{className:l.table.row.actions.container},void 0,[a.node(`button`,{className:l.table.row.actions.editButton,onclick:()=>m(b)},void 0,[`Edit Schema`])])}],resultsPerPage:10,resutlsPerPageOptions:[10,25,50,100],toolEnv:`admin`};j=new DynamicTable(e),d.append(a.node(`main`,{id:k.container},void 0,[a.node(`section`,{id:k.table.container},void 0,[j.renderComponentUi()]),a.node(`section`,{id:k.details.container},void 0,[a.node(`h3`,{id:k.details.title},void 0,[`Details Manager`]),a.node(`div`,{id:k.details.innerSlideContainer},void 0,[a.node(`div`,{id:k.details.memberPreview.container})])])])),c.append(d),setTimeout(()=>{j.loadPage(),m()},200)};this.renderUi=a=>n(a)}export{CatSchemaManager};
